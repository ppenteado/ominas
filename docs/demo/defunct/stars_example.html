<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.6.1 on Tue Jul 18 15:09:52 2017 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>stars_example.pro (OMINAS API Documentation)</title>

    

    <script type="text/javascript" src="../idldoc-resources/js/jquery.js"></script>
    <script type="text/javascript" src="../idldoc-resources/js/copybutton.js"></script>

    
    <style type="text/css" media="all">
            /* setup page */
      body { font-family: Helvetica, sans-serif; font-size: 12pt; margin: 0; padding: 0; }
      div.content { padding: 1em; }
      p { line-height: 1.4; }
      td p { padding-bottom: 0.5em; }
      img { border: 0; }
      
      /* link styles */
      a { text-decoration: none; }
      a:link, a:visited { color: #0000FF; }
      a:hover, a:focus { background: yellow; border-bottom: 1emx dotted #303099; }
      
      /* dir-overview styles */
      dt.filename { margin-top: 0.5em; }
      dl.file_listing { margin-left: 1em; }
      
      /* titles */
      h1, h2, h3, h4 { font-weight:normal; color: #871E31; margin-top: 1.5em; }
      h4 { margin-bottom: 0.25em; }
      .center { margin-left: auto; margin-right: auto; }
      .small { font-family: Verdana, Helvetica, sans-serif; font-size: 90%; }
      .smaller { font-family: Verdana, Helvetica, sans-serif; font-size: 80%; }
      .smallest { font-family: Verdana, Helvetica, sans-serif; font-size: 70%; }
      h1.basename { margin-top: 0; margin-bottom: 0; }
      h1.basename span.file-attributes { font-size: 70%; margin-left: 3em; color: #384806; }
      h2.directory { font-size: 90%; margin-bottom: 0; }
      h2.routine-name { margin-top: 0; margin-bottom: 0; }
      p.categories { color: #384806; margin-top: 0; }
      span.file_attribute { float: right; color: #384806; margin: 0 0 1em 3em; }
      div#file_comments { margin-top: 1em; }
      
      div.routine-details { border: 1px dotted #C0C0C0; margin-top: 1em; padding: 1em; }
      span.routine-attributes { font-size: 70%; margin-left: 3em; color: #384806; }
      div.details dt { color: #871E31; margin-left: 2em; }
      div.details dt span { color: #384806; margin-left: 2em; }
      div.details dd { margin: 0.5em 2em 1em 4em; }
      a.top {
        font-family: Verdana, Helvetica, sans-serif;
        font-size: 8pt;
        font-weight: bold;
        color: #5070ff;
        text-transform: uppercase;
        float: right;
        margin-left: 1em;
      }
      
      /* comments */
      .pre { white-space: pre; }
      
      /* code styles */
      code { font-family: Monaco, "Courier New", Courier, monospace; font-size: 95%; }
      code.listing { white-space: pre; display: block; margin: 0.75em 0 0.75em 0; padding: 0 3em 0 1em; line-height: 1.4em; }
      code.source { white-space: pre; display: block; }
      code.source span.comments { color: #408080; }
      .syntax { margin-top: 1em; margin-left: 1.5em; text-indent: -1.5em; }
      .var { font-style: italic; }
      .argument { } /* white-space: nowrap; does not work in Safari (and sometimes not even in Firefox) */
      
      dl.routine-summary dt { margin-bottom: 0.25em; }
      dl.routine-summary dd { margin-bottom: 0.5em; margin-left: 2em; }
      
      ul.inherited-method-summary { padding-left: 0em; margin-left: 0em; }
      
      /* general styles */
      ul li { list-style-type: none; }
      table { empty-cells: show; }
      thead { color: #871E31; }
      dd { margin-bottom: 0.35em; }
      input, textarea { background: #F3F6ED; border: #E1D6C6 1px solid; padding: 2px 1em 2px 0.5em; }
      input.text { background: #FFFFC0; }
      
      div.note { margin: 1em 2em 1em 2em; background: #EFEFEF; border: 1px #A0A0A0 dotted; padding: 0 1em 0 1em; }
      p.indent { margin-left: 2em; }
      
      /* An attribute table is a vertical list of name-value pairs. */
      table.box {
        background: #EFEFEF;
        border: 1px #A0A0A0 dotted;
        padding-top: 0.75em;
        padding-bottom: 0.75em;
      }
      table.attribute { padding-left: 0.75em; padding-right: 0.75em; }
      table td { vertical-align: top; }
      table.attribute p { margin: 0; }
      table td.name { font-style: normal; padding-right: 1.5em; }
      ul.fieldslist { padding-top: 0; color: #909090; }
      ul.fieldslist li { margin-bottom: 0.25em; }
      span.fieldname { color: #000000; }
      
      dl.attribute dt { color: #990000; }
      
      /* header/navbar styles */
      div.header { padding: 2em 2em 0 2em; background: #9E9D7B; border-bottom: 2px #262626 solid; }
      div.header h1 { color: white; margin:0; font-weight: normal; }
      div.header h2 { color: white; margin-top: 0; margin-bottom: 1em; font-weight: normal; font-style: italic; font-size: 100%; }
      table.navbar { background: #CCC097; margin: 0; padding: 0; border-bottom: 1px #262626 dotted; width: 100%; }
      table.navbar td { padding: 4px 0.5em 3px 0.5em; white-space: nowrap; vertical-align: top; }
      table.navbar td.flexible { width: 100%; text-align: right; padding-right: 1em; white-space: nowrap; }
      table.navbar td.selected { background: #262626; }
      table.navbar td.selected, table.navbar td.selected a { color: white; }
      table.navbar a:hover, table.navbar a:focus { background: inherit; border-bottom: 1px solid #303099; }
      p.localnavbar { text-align: right; margin: 0.2em 1em 0.2em 0.2em; padding: 0; }
      
      /* CSS graphics styles */
      div.box {
        margin-left: 0.25em;
        display: inline-block;
        width: 0.9em;
        height: 0.9em;
        vertical-align: -1px;
      }
      .red { background-color: #A00; }
      .orange { background-color: #F40; }
      .green { background-color: #480; }
      
      /* index styles */
      span.index_type { margin-left: 1em; }
      dl.index_listing dd { margin-bottom: 0.5em; margin-left: 2em; }
      dl.index_listing dd p { margin-top: 0.2em; margin-bottom: 0em; }
      
      /* search styles */
      fieldset { border: #ddd 1px solid; padding: 1em; margin-top: 3em; }
      legend { color: #871E31; font-size: 120%; }
      label { white-space: nowrap; }
      p.description { margin: 2em 2em 1em 2em; }
      form table td.name { vertical-align: middle; }
      
      /* footer styles */
      div.footer { padding: 0.5em 1em 0.5em 1em; background: #EFEFEF; border-top: 1px #A0A0A0 dotted; }
      div.footer table { width: 100%; }
      div.footer td.right { text-align: right; }

    </style>
    <style type="text/css" media="print">
            p.localnavbar { display: none; }
      
      div.header { background: white; }
      div.header h1 { color: black; }
      div.header h2 { color: black; }

    </style>
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="stars_example.pro (OMINAS API Documentation)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">

    <div class="header">
      <h1>OMINAS API Documentation</h1>
      <h2>Generated by IDLdoc</h2>
    </div>
    
    
    <table class="navbar smaller" summary="Navigation header" cellspacing="0">
      <tr>
        <td >
          <a href="../overview.html">Overview</a>
        </td>
    
        <td >
          Directory
        </td>
    
        <td class="selected">File</td>
    
        
    
        <td >Etc</td>
    
        <td >
          <a href="../categories.html">Categories</a>
        </td>
    
        <td >
          <a href="../search.html">Search</a>
        </td>
    
        
        <td >
          <a href="../idldoc-index.html">Index</a>
        </td>
        
    
        
        <td >
          <a href="../idldoc-warnings.html">Warnings</a>
        </td>
        
    
        <td >
          <a href="../idldoc-help.html">Help</a>
        </td>
    
        <td class="flexible">
          Developer documentation
        </td>
      </tr>
    </table>
    
    
    
    <p class="localnavbar smallest"><a href="" target="_top">single page</a> | <a href="../index.html" target="_top">use frames</a> &nbsp;&nbsp;&nbsp; summary &nbsp;&nbsp;&nbsp; class &nbsp;&nbsp;&nbsp; fields &nbsp;&nbsp;&nbsp; <a href="#routine-details">routine details</a> &nbsp;&nbsp;&nbsp; <a href="#attributes">file attributes</a></p>
    
    
    
    
    
    
    
    
    

    <div class="content">
      <h2 class="directory">defunct/</h2>
      <h1 class="basename">stars_example.pro<span class="file-attributes"></span></h1>
      

      
      <span class="file_attribute small">includes main-level program</span>
      
      <br/>

      
      <div id="file_comments">
        <div class="small "><h1> Star fitting example</h1>

<p> This example requires a star catalog. The options are: UCAC4, UCACT,
 TYCHO2, SAO, and GSC2. To learn more about where to obtain these
 catalogs, please see the documentation for the star catalog translators,
 <code>strcat_ucac4_input</code>, <code>strcat_ucact_input</code>, <code>strcat_tycho2_input</code>,
 <code>strcat_sao_input</code>, and <code>strcat_gsc2_input</code>.
</p>

<p> In this script, the star fitting capabilities of OMINAS will be demonstrated.
</p>

<p> This example file can be executed from the UNIX command line using:
<div><div><code class="listing"><span class="code-output">ominas stars_example</span>
</code></div></div> or from within an OMINAS IDL session using:
<div><div><code class="listing"><span class="code-output">@stars_example</span>
</code></div></div> After the example stops, later code samples in this file may be executed by
 pasting them onto the IDL command line.
</p>

<h1> Image read and display</h1>

<p> This first section uses <code>dat_read</code> to read in the image. There are several
 available image files to use for the preocessing:
</p>

<p> 	c1138223.gem: Voyager VICAR format file where the image has had
 	the camera distortions removed with the VICAR program GEOMA.
</p>

<p> 	N1456251768_1.IMG: Cassini ISS-NA image, obtained from the PDS imaging
 	node.
</p>

<p> <code>dat_read</code> reads the image portion (im) and the image label (label) and its
 output is a data descriptor (dd). tvim is called to display the image (im)
 at 3/4 size in a new window with the y coordinate as top-down.
</p>

<p> Note: Users with a 24-bit display, you may want to do the device command
 <code>'pseudo=8'</code> so that xloadct can be used to contrast enhance the image.
</p>

<p> Code:
<div><div><code class="listing"><span class="code-output">;dd = dat_read('data/c1138223.gem', im, label)           ; VICAR format file</span>
<span class="code-output">dd = dat_read(getenv('OMINAS_DIR')+'/demo/data/N1456251768_1.IMG', im, label)    ; Cas ISS-NA image</span>
<span class="code-output">tvim, im, zoom=0.75, /order</span>
</code></div></div></p>

<h1> Filling the descriptors</h1>

<p> This section fills the camera descriptor (cd), the planet descriptor
 (pd) and the ring descriptor (rd) for use by the software.
</p>

<p> Code:
<div><div><code class="listing"><span class="code-output">cd = pg_get_cameras(dd)</span>
<span class="code-output">pd = pg_get_planets(dd, od=cd)</span>
<span class="code-output">rd = pg_get_rings(dd, pd=pd, od=cd)</span>
</code></div></div></p>

<h1> Filling the generic descriptor</h1>

<p> This line fills a "generic" descriptor, which is a standard IDL struct.
 Generic descriptors are a convenient notation for several descriptors to
 be grouped into a structure that can be passed to functions in one piece.
</p>

<p> The components of the generic descriptor are:
<div><div><code class="listing"><span class="code-output">cd - camera descriptor part</span>
<span class="code-output">gbx - globe descriptor part</span>
<span class="code-output">dkx - disk descriptor part</span>
</code></div></div> Code:
<div><div><code class="listing"><span class="code-output">gd = {cd:cd, gbx:pd, dkx:rd}</span>
</code></div></div></p>

<h1> Filling the star descriptor</h1>

<p> This line fills a star descriptor by reading the star catalog using
 <code>pg_get_stars</code>. <code>pg_get_stars</code> calls back-end functions to read the
 translator table. Therefore, for a specific instrument (for instance,
 both ISS-NA and ISS-WA), the star catalog should be specified. The
 translators.tab for this demo (in data/translators.tab) should contain
 a line with the star catalog to be used:
<div><div><code class="listing"><span class="code-output"> -   strcat_tycho2_input     -       /j2000    # or /b1950 if desired</span>
</code></div></div> This line specifies that the tycho2 catalog should be used, and all
 coordinates should be for the j2000 epoch. Likewise, such a line should
 be included in the translator for any mission to be processed.
</p>

<p> NOTES:
  If the keyword 'tr_override' is specified, only the specified
  translator is called instead of whatever star catalog
  translators are listed in the translators table.
</p>

<p>  The translator keyword 'faint' selects only stars with magnitudes
  brighter than 14.  The keyword, 'bright' may be used place an upper
  bound on the brightness.
</p>

<p>  /no_sort suppresses the default behavior of returning only
  the first object found with any given name.  That operation can be
  very time consuming when a large number of objects are returned
  by the translators.  In the first case, we have specified that only one
  translator will be called, and we know that it will not return
  duplicate objects.
</p>

<p> Code:
<div><div><code class="listing"><span class="code-output">;sd = pg_get_stars(dd, od=cd, /no_sort, tr_ov='strcat_gsc2_input', 'faint=8')</span>
<span class="code-output">sd = pg_get_stars(dd, od=cd, 'faint=14')</span>
</code></div></div></p>

<h1> Calculating the star centers</h1>

<p> The star centers are calculated using <code>pg_center</code>. bx is an output
 keyword which contains the body descriptor, in this case it is an
 array of star descriptors. Each star descriptor describes the
 data for one star.
</p>

<p> <code>pg_hide</code> is called to remove (/rm) any star points covered by the
 planet (/globe). Although there is no planet in the Cassini image,
 this technique should be used to hide star points in general, were
 there to be a <code>limb_ptd</code>.
</p>

<h1> Determining the plot characteristics</h1>

<p> The star elements are chosen to be red, with a symbol type of *
 (code 2), a font size of 2, and labels corresponding to the name of
 each star. Stars can have either catalog names or common names.
</p>

<p> Code:
<div><div><code class="listing"><span class="code-output">star_ptd=pg_center(bx=sd, gd=gd) & pg_hide, star_ptd, gd=gd, bx=pd, /rm</span>
<span class="code-output">n_stars=n_elements(sd)</span>
<span class="code-output">color = ctred()</span>
<span class="code-output">psym = 6</span>
<span class="code-output">csizes = 2</span>
<span class="code-output">plabels = cor_name(sd)</span>
</code></div></div></p>

<h1> Drawing the star centers</h1>

<p> This section draws the stars in the star_ptd with the colors, plot
 symbols, font size, and labels defined earlier.
</p>

<p> In this particular example, the planet does not appear in the image.
</p>

<p> Code:
<div><div><code class="listing"><span class="code-output">pg_draw, star_ptd, color=color, psym=psym, plabel=plabels, csi=csizes</span>
</code></div></div></p>

<h1> Drawing the stellar spectral types</h1>

<p> This pasteable section uses the stellar library function str_sp to return
 spectral types of the stars and uses them instead of the star names. If
 the spectral type is not available for the catalog, then no information
 will be plotted in the labels.
</p>

<p> Code:
<div><div><code class="listing"><span class="code-output">tvim, im</span>
<span class="code-output">spt=str_sp(sd)</span>
<span class="code-output">psyms_str=make_array(n_stars,val=6)</span>
<span class="code-output">pg_draw, star_ptd, color=color, psym=psym, plabel=spt, csi=csizes</span>
</code></div></div></p>

<h1> Drawing stellar magnitudes</h1>

<p> This pasteable section uses the stellar library function str_get_mag to get
 visual magnitudes of the stars and uses them instead of the star names.
</p>

<p> Code:
<div><div><code class="listing"><span class="code-output">tvim, im</span>
<span class="code-output">sm = str_get_mag(sd)</span>
<span class="code-output">smag = string(sm, format='(f4.1)')</span>
<span class="code-output">psyms_str=make_array(n_stars,val=6)</span>
<span class="code-output">pg_draw, star_ptd, color=color, psym=psym, plabel=smag, csi=csizes</span>
</code></div></div></p>

<h1> Manually repointing the geometry</h1>

<p> This pasteable section first clears the screen of the plotted points
 by redisplaying the image with <code>tvim</code>.  It then calls <code>pg_drag</code> to allow
 the user to use the cursor to drag the pointing, and with it the stars.
 To move the pointing with <code>pg_drag</code>, use the left mouse button and
 translate the pointing in x,y.  Use the middle mouse button to rotate
 the pointing about an axis (in this case, the axis of rotation is set
 as the optic axis of the image (star_ptd) which is defined using the
 routine <code>pnt_create_descrptors</code> with the points being the camera optic
 axis as returned by the camera library routine cam_oaxis.  When the
 desired pointing is set, the right mouse button accepts it.  pg_drag
 returns the delta x,y amount dragged (dxy) as well as the rotation
 angle (dtheta).  <code>pg_repoint</code> uses the dxy and dtheta to update the
 camera descriptor (cd, passed by gd).  The limb, ring and star points
 are then recalculated, the image redisplayed to clear the objects drawn,
 and then <code>pg_draw</code> is called to replot.
</p>

<p> Code:
<div><div><code class="listing"><span class="code-output">optic_ptd = pnt_create_descriptors(points=cam_oaxis(cd))</span>
<span class="code-output">tvim, im</span>
<span class="code-output">dxy = pg_drag(star_ptd, dtheta=dtheta, axis=optic_ptd, symbol=6)  ; square</span>
<span class="code-output">pg_repoint, dxy, dtheta, axis=optic_ptd, gd=gd</span>
<span class="code-output">star_ptd=pg_center(bx=sd, gd=gd) & pg_hide, star_ptd, gd=gd, bx=pd, /rm</span>
<span class="code-output">tvim, im</span>
<span class="code-output">pg_draw, star_ptd, color=color, psym=psym, plabel=plabels</span>
</code></div></div></p>

<h1> Scanning to find the stars and using it to calculate the pointing</h1>

<p> This section calls <code>pg_ptscan</code> to scan the image around the predicted
 star positions (within width of 40 pixels) and find the pixels with
 the highest correlation with a given edge model (example uses the
 default gaussian) for each star.  These points are then plotted.
</p>

<p> Code:
<div><div><code class="listing"><span class="code-output">ptscan_ptd = pg_ptscan(dd, star_ptd, edge=30, width=40)</span>
<span class="code-output">pg_draw, ptscan_ptd, psym=1, col=ctyellow()</span>
</code></div></div></p>

<h1> Thresholding using correlation coefficient</h1>

<p> This section (optional) calls <code>pg_threshold</code> to remove points with lower
 correlation coefficients.  This example only keeps stars with a
 correlation coefficient above 0.6.  Notice that each object can have
 its own min and max value.
</p>

<p> Code:
<div><div><code class="listing"><span class="code-output">pg_threshold, ptscan_ptd, min=make_array(n_stars,val=0.6), $</span>
<span class="code-output">                          max=make_array(n_stars,val=1.0)</span>
<span class="code-output">tvim, im</span>
<span class="code-output">pg_draw, object_ptd, colors=colors, psyms=psyms, psizes=psizes, plabel=plabels</span>
<span class="code-output">pg_draw, ptscan_ptd, psym=1, col=ctyellow()</span>
</code></div></div></p>

<h1> Removing regions of bad points</h1>

<p> This section (optional) calls <code>pg_select</code> to remove points within a
 polygonal region as defined by the cursor.  Click the left mouse
 button to mark a point and move the mouse to the next point and
 click.  Use the middle mouse button to erase a point and the right
 mouse button to end the region.  <code>pg_trim</code> removes the points in the
 just defined region.  The scan points are then replotted.
 Repeat these statements for each region a user wants to remove.
</p>

<p> Code:
<div><div><code class="listing"><span class="code-output">region=pg_select(dd)</span>
<span class="code-output">pg_trim, dd, ptscan_ptd, region</span>
<span class="code-output">tvim, im</span>
<span class="code-output">pg_draw, object_ptd, colors=colors, psyms=psyms, psizes=psizes, plabel=plabels</span>
<span class="code-output">pg_draw, ptscan_ptd, psym=1, col=ctyellow()</span>
</code></div></div></p>

<h1> Fitting the pointing to the found stars</h1>

<p> This section calls <code>pg_ptscan_coeff</code> to determine the linear
 least-squares coefficients for a fit to the image coordinate translation
 and rotation which matches the computed positions to the scanned
 positions. It then calls <code>pg_fit</code> to do the fit with the calculated
 coefficients to calculate the correction in translation (dxy) and
 rotation (dtheta).  It calls <code>pg_ptchisq</code> to get the chi square of the
 fit.  It then calls <code>pg_repoint</code> to update the pointing.  Recalculates
 the limb, rings and stars and replots.
</p>

<p> Code:
<div><div><code class="listing"><span class="code-output">optic_ptd = pnt_create_descriptors(points=cam_oaxis(cd))</span>
<span class="code-output">ptscan_cf = pg_ptscan_coeff(ptscan_ptd, axis=optic_ptd)</span>
<span class="code-output">dxy = pg_fit([ptscan_cf], dtheta=dtheta)</span>
<span class="code-output">chisq = pg_chisq(dxy, dtheta, ptscan_ptd, axis=optic_ptd[0])</span>
<span class="code-output">covar = pg_covariance([ptscan_cf])</span>
<span class="code-output">print, dxy, dtheta*180./!pi, chisq, covar</span>
<span class="code-output">pg_repoint, dxy, dtheta, axis=optic_ptd, gd=gd</span>
<span class="code-output">star_ptd = pg_center(bx=sd, gd=gd) & pg_hide, star_ptd, gd=gd, bx=pd, /rm</span>
<span class="code-output">tvim, im</span>
<span class="code-output">pg_draw, star_ptd, color=color, psym=psym, plabel=plabels</span>
</code></div></div></p>

<h1> Output the new state</h1>

<p> This section (optional) shows how you can save your output: any changes
 to the image data into a new file and the new pointing into a detached
 header.
</p>

<p> Code:
<div><div><code class="listing"><span class="code-output">pg_put_cameras, dd, gd=gd</span>
<span class="code-output">dat_write, getenv('OMINAS_DIR')+'/demo/data/c1138223_nv.gem', dd</span>
</code></div></div></p>

</div>
      </div>
      

      

      

      

      

      

      

      

      

      

      <div id="attributes">
        <h2>File attributes</h2>

        <table class="attribute small" summary="File attributes">
          <tr>
            <td class="name">Modification date:</td>
            <td>Tue Jul 18 11:30:24 2017</td>
          </tr>

          <tr>
            <td class="name">Lines:</td>
            <td>56</td>
          </tr>

          
          <tr>
            <td class="name">Docformat:</td>
            <td>rst rst</td>
          </tr>
          
        </table>
      </div>

      
    </div>

    <div class="footer">
    
      <table class="smaller" summary="footer">
        <tr>
          <td class="left">Produced by IDLdoc 3.6.1 on Tue Jul 18 15:09:52 2017</td>
          <td class="right"><a target="_top" href="http://github.com/mgalloy/idldoc">IDLdoc project information</a></td>
        </tr>
      </table>
    
    </div>
  </body>
</html>