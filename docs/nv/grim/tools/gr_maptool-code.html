<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<!-- Generated by IDLdoc 3.6.1 on Fri Jul 14 10:59:43 2017 -->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>gr_maptool.pro (OMINAS API Documentation)</title>

    
    <style type="text/css" media="all">
            /* setup page */
      body { font-family: Helvetica, sans-serif; font-size: 12pt; margin: 0; padding: 0; }
      div.content { padding: 1em; }
      p { line-height: 1.4; }
      td p { padding-bottom: 0.5em; }
      img { border: 0; }
      
      /* link styles */
      a { text-decoration: none; }
      a:link, a:visited { color: #0000FF; }
      a:hover, a:focus { background: yellow; border-bottom: 1emx dotted #303099; }
      
      /* dir-overview styles */
      dt.filename { margin-top: 0.5em; }
      dl.file_listing { margin-left: 1em; }
      
      /* titles */
      h1, h2, h3, h4 { font-weight:normal; color: #871E31; margin-top: 1.5em; }
      h4 { margin-bottom: 0.25em; }
      .center { margin-left: auto; margin-right: auto; }
      .small { font-family: Verdana, Helvetica, sans-serif; font-size: 90%; }
      .smaller { font-family: Verdana, Helvetica, sans-serif; font-size: 80%; }
      .smallest { font-family: Verdana, Helvetica, sans-serif; font-size: 70%; }
      h1.basename { margin-top: 0; margin-bottom: 0; }
      h1.basename span.file-attributes { font-size: 70%; margin-left: 3em; color: #384806; }
      h2.directory { font-size: 90%; margin-bottom: 0; }
      h2.routine-name { margin-top: 0; margin-bottom: 0; }
      p.categories { color: #384806; margin-top: 0; }
      span.file_attribute { float: right; color: #384806; margin: 0 0 1em 3em; }
      div#file_comments { margin-top: 1em; }
      
      div.routine-details { border: 1px dotted #C0C0C0; margin-top: 1em; padding: 1em; }
      span.routine-attributes { font-size: 70%; margin-left: 3em; color: #384806; }
      div.details dt { color: #871E31; margin-left: 2em; }
      div.details dt span { color: #384806; margin-left: 2em; }
      div.details dd { margin: 0.5em 2em 1em 4em; }
      a.top {
        font-family: Verdana, Helvetica, sans-serif;
        font-size: 8pt;
        font-weight: bold;
        color: #5070ff;
        text-transform: uppercase;
        float: right;
        margin-left: 1em;
      }
      
      /* comments */
      .pre { white-space: pre; }
      
      /* code styles */
      code { font-family: Monaco, "Courier New", Courier, monospace; font-size: 95%; }
      code.listing { white-space: pre; display: block; margin: 0.75em 0 0.75em 0; padding: 0 3em 0 1em; line-height: 1.4em; }
      code.source { white-space: pre; display: block; }
      code.source span.comments { color: #408080; }
      .syntax { margin-top: 1em; margin-left: 1.5em; text-indent: -1.5em; }
      .var { font-style: italic; }
      .argument { } /* white-space: nowrap; does not work in Safari (and sometimes not even in Firefox) */
      
      dl.routine-summary dt { margin-bottom: 0.25em; }
      dl.routine-summary dd { margin-bottom: 0.5em; margin-left: 2em; }
      
      ul.inherited-method-summary { padding-left: 0em; margin-left: 0em; }
      
      /* general styles */
      ul li { list-style-type: none; }
      table { empty-cells: show; }
      thead { color: #871E31; }
      dd { margin-bottom: 0.35em; }
      input, textarea { background: #F3F6ED; border: #E1D6C6 1px solid; padding: 2px 1em 2px 0.5em; }
      input.text { background: #FFFFC0; }
      
      div.note { margin: 1em 2em 1em 2em; background: #EFEFEF; border: 1px #A0A0A0 dotted; padding: 0 1em 0 1em; }
      p.indent { margin-left: 2em; }
      
      /* An attribute table is a vertical list of name-value pairs. */
      table.box {
        background: #EFEFEF;
        border: 1px #A0A0A0 dotted;
        padding-top: 0.75em;
        padding-bottom: 0.75em;
      }
      table.attribute { padding-left: 0.75em; padding-right: 0.75em; }
      table td { vertical-align: top; }
      table.attribute p { margin: 0; }
      table td.name { font-style: normal; padding-right: 1.5em; }
      ul.fieldslist { padding-top: 0; color: #909090; }
      ul.fieldslist li { margin-bottom: 0.25em; }
      span.fieldname { color: #000000; }
      
      dl.attribute dt { color: #990000; }
      
      /* header/navbar styles */
      div.header { padding: 2em 2em 0 2em; background: #9E9D7B; border-bottom: 2px #262626 solid; }
      div.header h1 { color: white; margin:0; font-weight: normal; }
      div.header h2 { color: white; margin-top: 0; margin-bottom: 1em; font-weight: normal; font-style: italic; font-size: 100%; }
      table.navbar { background: #CCC097; margin: 0; padding: 0; border-bottom: 1px #262626 dotted; width: 100%; }
      table.navbar td { padding: 4px 0.5em 3px 0.5em; white-space: nowrap; vertical-align: top; }
      table.navbar td.flexible { width: 100%; text-align: right; padding-right: 1em; white-space: nowrap; }
      table.navbar td.selected { background: #262626; }
      table.navbar td.selected, table.navbar td.selected a { color: white; }
      table.navbar a:hover, table.navbar a:focus { background: inherit; border-bottom: 1px solid #303099; }
      p.localnavbar { text-align: right; margin: 0.2em 1em 0.2em 0.2em; padding: 0; }
      
      /* CSS graphics styles */
      div.box {
        margin-left: 0.25em;
        display: inline-block;
        width: 0.9em;
        height: 0.9em;
        vertical-align: -1px;
      }
      .red { background-color: #A00; }
      .orange { background-color: #F40; }
      .green { background-color: #480; }
      
      /* index styles */
      span.index_type { margin-left: 1em; }
      dl.index_listing dd { margin-bottom: 0.5em; margin-left: 2em; }
      dl.index_listing dd p { margin-top: 0.2em; margin-bottom: 0em; }
      
      /* search styles */
      fieldset { border: #ddd 1px solid; padding: 1em; margin-top: 3em; }
      legend { color: #871E31; font-size: 120%; }
      label { white-space: nowrap; }
      p.description { margin: 2em 2em 1em 2em; }
      form table td.name { vertical-align: middle; }
      
      /* footer styles */
      div.footer { padding: 0.5em 1em 0.5em 1em; background: #EFEFEF; border-top: 1px #A0A0A0 dotted; }
      div.footer table { width: 100%; }
      div.footer td.right { text-align: right; }

    </style>
    <style type="text/css" media="print">
            p.localnavbar { display: none; }
      
      div.header { background: white; }
      div.header h1 { color: black; }
      div.header h2 { color: black; }

    </style>
    

    <script type="text/javascript">
      function setTitle() {
        parent.document.title="gr_maptool.pro (OMINAS API Documentation)";
      }
    </script>
  </head>

  <body onload="setTitle();" id="root">
    <div class="content">
      <code class="source"><span class="comments">;=============================================================================</span>
<span class="comments">;+</span>
<span class="comments">; NAME:</span>
<span class="comments">;	gr_maptool</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">; DESCRIPTION:</span>
<span class="comments">;	Graphical map projection tool. </span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">; CALLING SEQUENCE:</span>
<span class="comments">;	</span>
<span class="comments">;	gr_maptool</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">; ARGUMENTS:</span>
<span class="comments">;  INPUT: NONE</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">;  OUTPUT: NONE</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">; KEYWORDS:</span>
<span class="comments">;  INPUT: NONE</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">;  OUTPUT: NONE</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">; LAYOUT:</span>
<span class="comments">;	The gr_maptool layout consists of the following items:</span>
<span class="comments">;</span>
<span class="comments">;	 Map projection control:</span>
<span class="comments">;		A map projection is selected using the droplist and </span>
<span class="comments">;		the map parameters are input using the text widgets below.</span>
<span class="comments">;		Angles are in radians.</span>
<span class="comments">;</span>
<span class="comments">;	'Ok' button:</span>
<span class="comments">;		Creates the map projection described by the current widget</span>
<span class="comments">;		settings and exits.</span>
<span class="comments">;</span>
<span class="comments">;	'Apply' button:</span>
<span class="comments">;		Creates the map projection described by the current widget</span>
<span class="comments">;		settings without exiting.</span>
<span class="comments">;</span>
<span class="comments">;	'Cancel' button</span>
<span class="comments">;		Exits with no map projection.		</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">; OPERATION:</span>
<span class="comments">;	gr_ maptool allows the user to create map projections of images</span>
<span class="comments">;	using a simple graphical interface.  It is most easily run from within</span>
<span class="comments">;	GRIM, but may be run directly from the command line as well.</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">; STATUS:</span>
<span class="comments">;	Incomplete.</span>
<span class="comments">;</span>
<span class="comments">;</span>
<span class="comments">; MODIFICATION HISTORY:</span>
<span class="comments">; 	Written by:	Spitale 7/2002</span>
<span class="comments">;	</span>
<span class="comments">;-</span>
<span class="comments">;=============================================================================</span>

<span class="comments">;=============================================================================</span>
<span class="comments">; grmt_get_md</span>
<span class="comments">;</span>
<span class="comments">;=============================================================================</span>
<a id="grmt_get_md:source"></a>function grmt_get_md, data, type, index=index

 types = map_type(data.mds)
 w = where(types EQ strupcase(type))
 index = w[0]

 return, data.mds[index]
end
<span class="comments">;=============================================================================</span>



<span class="comments">;=============================================================================</span>
<span class="comments">; grmt_create_map</span>
<span class="comments">;</span>
<span class="comments">;=============================================================================</span>
<a id="grmt_create_map:source"></a>pro grmt_create_map, data, md

 ingrid, dd=dd, cd=cd, sund=sund, active_pd=pd, active_rd=rd, pd=all_pd
 class = cor_udata(md, 'CLASS')
 
 if(NOT keyword__set(cd)) then $
  begin
   grim_message, 'No camera descriptor.'
   return
  end

 if(NOT keyword__set(sund)) then $
  begin
   grim_message, 'No sun descriptor.'
   return
  end


 <span class="comments">;-----------------------------------</span>
 <span class="comments">; project map</span>
 <span class="comments">;-----------------------------------</span>
 widget_control, /hourglass

 case class of
  'GLOBE' : $
	begin
	 if(keyword_set(rd)) then $
	  begin
	   hide_fn = 'pm_hide_ring'
           hide_data_p = nv_ptr_new(rd)
	  end

	 if(keyword_set(pd)) then $
          begin
           cor_set_name, md, cor_name(pd[0])
           gbx = pd[0]
	   map_pd = pd[0]
          end $
<span class="comments">;         else cor_set_name, md, cor_name(cd)</span>
         else $
          begin
           grim_message, 'No planet descriptor.'
           return
          end

	 aux= ['EMM']

	 dd_map = pg_map(dd, $
                    md=md, $
                    cd=cd, $
                    sund=sund, $
                    gbx=gbx, aux=['EMM'], $
                    hide_fn=hide_fn, hide_data_p=hide_data_p)
	end

  'DISK' : $
	begin
<span class="comments">; need to sort out the map units...</span>
 grim_message, 'Not complete.'
 return

	 if(NOT keyword_set(rd)) then $
	  begin
	   grim_message, 'No active ring descriptor.'
	   return
	  end
	 if(NOT keyword_set(all_pd)) then $
	  begin
	   grim_message, 'No globe descriptor.'
	   return
	  end

	 cor_set_name, md, cor_name(rd[0])

	 dd_map = pg_map(dd, bx=rd[0], $
                    md=md, $
                    cd=cd, $
                    sund=sund, $
                    gbx=all_pd, $
                    hide_fn=hide_fn, hide_data_p=hide_data_p)

	 map_rd = rd[0]
	end

 endcase


 <span class="comments">;-----------------------------------</span>
 <span class="comments">; open map in grim</span>
 <span class="comments">;-----------------------------------</span>
 if(cor_class(cd) NE 'MAP') then od = cd
 grim, /new, dd_map, cd=md, od=od, sund=sund, pd=map_pd, rd=map_rd, $
              /tiepoint_sync, /curve_sync, order=1-data.order, $
              title=map_type(md) + ' ' + cor_name(dd)


end
<span class="comments">;=============================================================================</span>



<span class="comments">;=============================================================================</span>
<span class="comments">; grmt_parse_entry</span>
<span class="comments">;</span>
<span class="comments">;=============================================================================</span>
<a id="grmt_parse_entry:source"></a>function grmt_parse_entry, ids, tags, tag, drop=drop

 i = (where(tags EQ tag))[0]

 if(NOT keyword__set(drop)) then $
  begin   
   widget_control, ids[i], get_value=value
   value = str_sep(strtrim(value,2), ' ')
  end $
 else value = widget_info(ids[i], /droplist_select)

 return, value
end
<span class="comments">;=============================================================================</span>



<span class="comments">;=============================================================================</span>
<span class="comments">; grmt_set_entry</span>
<span class="comments">;</span>
<span class="comments">;=============================================================================</span>
<a id="grmt_set_entry:source"></a>pro grmt_set_entry, ids, tags, tag, value, drop=drop

 i = (where(tags EQ tag))[0]

 if(NOT keyword__set(drop)) then $
         widget_control, ids[i], set_value = strtrim(value,2) + ' ' $
 else widget_control, ids[i], set_droplist_select=value

end
<span class="comments">;=============================================================================</span>



<span class="comments">;=============================================================================</span>
<span class="comments">; grmt_form_to_md</span>
<span class="comments">;</span>
<span class="comments">;=============================================================================</span>
<a id="grmt_form_to_md:source"></a>function grmt_form_to_md, data, type=type

 class = strupcase(data.classes[ $
               grmt_parse_entry(data.ids, data.tags, 'CLASS', /drop)])

 size = long(grmt_parse_entry(data.ids, data.tags, 'SIZE'))
 scale = double(grmt_parse_entry(data.ids, data.tags, 'SCALE'))
 origin = double(grmt_parse_entry(data.ids, data.tags, 'ORIGIN'))

 units = double(grmt_parse_entry(data.ids, data.tags, 'UNITS'))
 center = double(grmt_parse_entry(data.ids, data.tags, 'CENTER'))

 if(class EQ 'DISK') then center[1] = center[1] * !dpi/180d $
 else center = center * !dpi/180d

 if(NOT keyword__set(type)) then $
  begin
   type_index = long(grmt_parse_entry(data.ids, data.tags, 'TYPE', /drop))
   type = strupcase(data.types[type_index])
  end

 ingrid, dd=dd
 md = map_create_descriptors(1, $
		type=type, $
		size=size, $
		scale=scale, $
		origin=origin, $
		units=units, $
		center=center, $
		gd=dd)

 cor_set_udata, md, 'CLASS', class

 return, md
end
<span class="comments">;=============================================================================</span>



<span class="comments">;=============================================================================</span>
<span class="comments">; grmt_md_to_form</span>
<span class="comments">;</span>
<span class="comments">;=============================================================================</span>
<a id="grmt_md_to_form:source"></a>pro grmt_md_to_form, data, md

 grmt_set_entry, data.ids, data.tags, 'SIZE', map_size(md)
 grmt_set_entry, data.ids, data.tags, 'SCALE', map_scale(md)

 origin = strtrim(map_origin(md), 2)
 grmt_set_entry, data.ids, data.tags, 'ORIGIN', strmid(origin, 0, 6)

 units = strtrim(map_units(md), 2)
 grmt_set_entry, data.ids, data.tags, 'UNITS', strmid(units, 0, 6)

 center = strtrim(map_center(md) * 180d/!dpi, 2)
 grmt_set_entry, data.ids, data.tags, 'CENTER', strmid(center, 0, 6)

 type_index = (where(strupcase(data.types) EQ map_type(md)))[0]
 grmt_set_entry, data.ids, data.tags, 'TYPE', type_index, /drop

 data.last_type = data.types[type_index]
 widget_control, data.base, set_uvalue=data

end
<span class="comments">;=============================================================================</span>



<span class="comments">;=============================================================================</span>
<span class="comments">; grmt_cleanup</span>
<span class="comments">;</span>
<span class="comments">;=============================================================================</span>
<a id="grmt_cleanup:source"></a>pro grmt_cleanup, base

 widget_control, base, get_uvalue=data

 grim_rm_refresh_callback, data.cb_data_p

end
<span class="comments">;=============================================================================</span>



<span class="comments">;=============================================================================</span>
<span class="comments">; grmt_refresh_callback</span>
<span class="comments">;</span>
<span class="comments">;=============================================================================</span>
<a id="grmt_refresh_callback:source"></a>pro grmt_refresh_callback, data_p
 @grim_block.include


 if(NOT ptr_valid(data_p)) then return
 
 data = *data_p 
 w1 = where(data.tags EQ 'PROJECT')
 w2 = where(data.tags EQ 'OK')

 if(NOT widget_info(data.ids[w1], /valid_id)) then return
 if(NOT widget_info(data.ids[w2], /valid_id)) then return

 ingrid, dd=dd, cd=cd, sund=sund, active_pd=pd, active_rd=rd

 if((NOT keyword__set(cd)) OR $
    (NOT keyword__set(pd)) OR $
    (NOT keyword__set(sund))) then $
  begin
<span class="comments">;   widget_control, data.ids[w1], sensitive=0</span>
<span class="comments">;   widget_control, data.ids[w2], sensitive=0</span>
  end $
 else $
  begin
<span class="comments">;   widget_control, data.ids[w1], sensitive=1</span>
<span class="comments">;   widget_control, data.ids[w2], sensitive=1</span>
  end


end
<span class="comments">;=============================================================================</span>



<span class="comments">;=============================================================================</span>
<span class="comments">; gr_maptool_event</span>
<span class="comments">;</span>
<span class="comments">;=============================================================================</span>
<a id="gr_maptool_event:source"></a>pro gr_maptool_event, event

 <span class="comments">;-----------------------------------------------</span>
 <span class="comments">; get map form base and grim data structure</span>
 <span class="comments">;-----------------------------------------------</span>
 base = event.top
 widget_control, base, get_uvalue=data

 <span class="comments">;-----------------------------------------------</span>
 <span class="comments">; get form value structure</span>
 <span class="comments">;-----------------------------------------------</span>
 widget_control, event.id, get_value=value

 <span class="comments">;-----------------------------------------------</span>
 <span class="comments">; get tag names, widget ids, and types</span>
 <span class="comments">;-----------------------------------------------</span>
 tags = data.tags
 ids = data.ids
 types = data.types

 case event.tag of
  <span class="comments">;---------------------------------------------------------</span>
  <span class="comments">; 'Class' button --</span>
  <span class="comments">;---------------------------------------------------------</span>
  'CLASS' :  

  <span class="comments">;---------------------------------------------------------</span>
  <span class="comments">; 'Auto' button --</span>
  <span class="comments">;  Compute optimal map params based on current grim view.</span>
  <span class="comments">;---------------------------------------------------------</span>
  'AUTO' : $
	begin
	 md = grmt_form_to_md(data)
	 class = cor_udata(md, 'CLASS')
	 case class of
	  'GLOBE' : $
	 	begin
<span class="comments">;		 md = grmt_form_to_md(data)</span>
<span class="comments">;		 md = map_optimize(md=md, $</span>
<span class="comments">;		       lon=[lonmin,lonmax], $</span>
<span class="comments">;		       lat=[latmin,latmax])</span>



<span class="comments">;		 md = map_create_descriptors(1, $</span>
<span class="comments">;;			type=type, $</span>
<span class="comments">;;			size=size, $</span>
<span class="comments">;			scale=scale, $</span>
<span class="comments">;;			origin=origin, $</span>
<span class="comments">;			units=units, $</span>
<span class="comments">;			center=center)</span>
<span class="comments">;	         grmt_md_to_form, data, md</span>
<span class="comments">;		 widget_control, base, set_uvalue=data</span>
		end
	  'DISK' : $
		begin
		end
	 endcase
	end

  <span class="comments">;---------------------------------------------------------</span>
  <span class="comments">; 'Close' button --</span>
  <span class="comments">;  Just destroy the form and forget about it</span>
  <span class="comments">;---------------------------------------------------------</span>
  'CLOSE' :  widget_control, base, /destroy

  <span class="comments">;---------------------------------------------------------</span>
  <span class="comments">; 'Project' button --</span>
  <span class="comments">;  Create a map projection using the current settings.</span>
  <span class="comments">;---------------------------------------------------------</span>
  'PROJECT' : $
	begin
	 md = grmt_form_to_md(data)
	 grmt_create_map, data, md
	end

  <span class="comments">;---------------------------------------------------------</span>
  <span class="comments">; 'Ok' button --</span>
  <span class="comments">;  Create a map projection using the current settings</span>
  <span class="comments">;  and destroy form.</span>
  <span class="comments">;---------------------------------------------------------</span>
  'OK' : $
	begin
	 md = grmt_form_to_md(data)
	 grmt_create_map, data, md
	 widget_control, base, /destroy
	end

  <span class="comments">;---------------------------------------------------------------</span>
  <span class="comments">; Projection type --</span>
  <span class="comments">;  Save the current setting in the appropriate map descriptor</span>
  <span class="comments">;  and restore the displayed settings to those of the new map </span>
  <span class="comments">;  descriptor.</span>
  <span class="comments">;---------------------------------------------------------------</span>
  'TYPE' : $
	begin
	 md_form = grmt_form_to_md(data, type=data.last_type)
	 md = grmt_get_md(data, data.last_type, index=index)
	 nv_copy, md, md_form

	 md = grmt_get_md(data, types[value.type])
         grmt_md_to_form, data, md

	 widget_control, base, set_uvalue=data
	end

  <span class="comments">;---------------------------------------------------------</span>
  <span class="comments">; 'Size' value --</span>
  <span class="comments">;  Automatically change map origin</span>
  <span class="comments">;---------------------------------------------------------</span>
  'SIZE' : $
	begin
	 md = grmt_form_to_md(data)
	 map_set_origin, md, double(map_size(md))/2d
         grmt_md_to_form, data, md
	end

  else:
 endcase



end
<span class="comments">;=============================================================================</span>



<span class="comments">;=============================================================================</span>
<span class="comments">; gr_maptool</span>
<span class="comments">;</span>
<span class="comments">;=============================================================================</span>
<a id="gr_maptool:source"></a>pro gr_maptool, order=order

 if(xregistered('gr_maptool')) then return


 <span class="comments">;-----------------------------------------------</span>
 <span class="comments">; setup map form widget</span>
 <span class="comments">;-----------------------------------------------</span>
 base = widget_base(title = 'Map projection', group=top)

 classes = ['Globe', $
            'Disk']
 nclasses = n_elements(classes)
 dl_classes = classes[0]
 for i=1, nclasses-1 do dl_classes = dl_classes + '|' + classes[i]

 types = ['Rectangular', $
          'Mercator', $
          'Orthographic', $
          'Stereographic']<span class="comments">;, $</span>
<span class="comments">;          'Sinusoidal', $</span>
<span class="comments">;          'Mollweide', $</span>
<span class="comments">;          'Oblique Disk']</span>
 ntypes = n_elements(types)
 dl_types = types[0]
 for i=1, ntypes-1 do dl_types = dl_types + '|' + types[i]

 desc = [ $
	'1, BASE,, COLUMN, FRAME', $
	  '0, DROPLIST,' + dl_classes + ',SET_VALUE=0' + $
	           ',LABEL_LEFT=Class            :, TAG=class', $
	  '0, DROPLIST,' + dl_types + ',SET_VALUE=0' + $
	           ',LABEL_LEFT=Projection       :, TAG=type', $
	  '0, TEXT,, LABEL_LEFT=Size             :   , WIDTH=20, TAG=size', $
	    '1, BASE,, ROW, FRAME', $
	    '2, BUTTON, Auto,, TAG=auto', $
<span class="comments">;	    '2, BUTTON, Select,, TAG=select', $</span>
	  '0, TEXT,, LABEL_LEFT=  Origin         :   , WIDTH=20, TAG=origin', $
	  '0, TEXT,, LABEL_LEFT=  Scale          :   , WIDTH=20, TAG=scale', $
	  '0, TEXT,, LABEL_LEFT=  Center(deg)    :   , WIDTH=20, TAG=center', $
	  '0, TEXT,, LABEL_LEFT=  Units(rad/unit):   , WIDTH=20, TAG=units', $
	'1, BASE,, ROW, FRAME', $
	  '0, BUTTON, Ok, QUIT, TAG=ok', $
	  '0, BUTTON, Project,, TAG=project', $
	  '2, BUTTON, Close, QUIT, TAG=close']

 form = cw__form(base, desc, ids=ids, tags=tags)
 widget_control, form, set_uvalue={ids:ids, tags:tags, types:types}


 <span class="comments">;-----------------------------------------------</span>
 <span class="comments">; main data structure</span>
 <span class="comments">;-----------------------------------------------</span>
 data = { $
	<span class="comments">;---------------</span>
	<span class="comments">; widgets</span>
	<span class="comments">;---------------</span>
		base		:	base, $
		form		:	form, $
		ids		:	ids, $
		tags		:	tags, $
		types		:	types, $
		classes		:	classes, $
		order		:	order, $
	<span class="comments">;---------------</span>
	<span class="comments">; book keeping</span>
	<span class="comments">;---------------</span>
		last_type	:	'', $
		cb_data_p	:	nv_ptr_new(), $
	<span class="comments">;-----------------------------</span>
	<span class="comments">; default map descriptors</span>
	<span class="comments">;-----------------------------</span>
		mds 		:	[ map_create_descriptors(1,$
					   type='RECTANGULAR', $
					   size = [800,400]), $
					  map_create_descriptors(1,$
					   type='MERCATOR', $
					   size = [800,400]), $
					  map_create_descriptors(1,$
					   type='ORTHOGRAPHIC', $
					   size = [400,400]), $
					  map_create_descriptors(1,$
					   type='STEREOGRAPHIC', $
					   size = [400,400])   ]$<span class="comments">;, $</span>
<span class="comments">;					  map_create_descriptors(1,$</span>
<span class="comments">;					   type='SINUSOIDAL', $</span>
<span class="comments">;					   size = [800,400]), $</span>
<span class="comments">;					  map_create_descriptors(1,$</span>
<span class="comments">;					   type='MOLLWEIDE', $</span>
<span class="comments">;					   size = [800,400]), $</span>
<span class="comments">;					  map_create_descriptors(1,$</span>
<span class="comments">;					   type='OBLIQUE_DISK', $</span>
<span class="comments">;					   size = [400,400]) ] $ </span>
	     }

 data.types = map_type(data.mds)
 widget_control, base, set_uvalue=data

 data.cb_data_p = nv_ptr_new(data)
 grim_add_refresh_callback, 'grmt_refresh_callback', data.cb_data_p
 grmt_refresh_callback, data.cb_data_p


 <span class="comments">;-----------------------------------------------------</span>
 <span class="comments">; realize and register</span>
 <span class="comments">;-----------------------------------------------------</span>
 widget_control, base, /realize
 xmanager, 'gr_maptool', base, /no_block, cleanup='grmt_cleanup'

 <span class="comments">;-----------------------------------------------------</span>
 <span class="comments">; initial form settings</span>
 <span class="comments">;-----------------------------------------------------</span>
 grmt_md_to_form, data, grmt_get_md(data, 'RECTANGULAR') 


end
<span class="comments">;=============================================================================</span>
</code>
    </div>
  </body>
</html>